!function(e){function t(o){if(a[o])return a[o].exports;var i=a[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){e.exports=a(1)},function(e,t,a){a(2),MI.buySuccess=function(){function e(e){e&&$("#J_buyRecommend").miRecommend({type:"buyRecommend",gid:e})}function t(t){if(t){var o=MI.GLOBAL_CONFIG.cartSite+"/cart/getItem.php?gid="+t;$.ajax({url:o,dataType:"jsonp",jsonp:"jsonpcallback",timeout:1e4,error:function(){},success:function(t){t&&1===t.code&&t.data?(a(t.data),e(t.data.commodity_id)):location.href=MI.GLOBAL_CONFIG.staticSite+"/cart/"}})}}function a(e){var t=doT.template($("#J_goodsTemplate").html());("fail"===i.insurance||"fail"===i.relation)&&($(".J_actBox").addClass("act_notic"),$(".J_notic").removeClass("hide")),e.service="success"===i.insurance||"success"===i.relation?!0:!1;var a=t(e);$("#J_goodsBox").html(a)}function o(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(t);return null!==a?decodeURIComponent(a[2]):null}var i=this,r=function(){i.insurance=o("insurance"),i.relation=o("relation");var e=o("gid");e?t(e):location.href=MI.GLOBAL_CONFIG.staticSite+"/cart/",$(".J_goBack").on("click",function(){o("pid")?location.href=MI.GLOBAL_CONFIG.itemSite+("product"===o("protype")?"/product/":"/")+o("pid")+".html":history.go(-1)})};return{init:r}}(),$(document).ready(function(){MI.buySuccess.init()})},function(e,t,a){function o(e,t,a){var o=e.find("a");$.each(o,function(e,o){var i,r=$(o).attr("data-stat-index"),n=c($(o).attr("data-stat-text")),s=$(o).attr("data-stat-method"),l=$(o).attr("data-stat-addcart");i=l?"stat_"+t+l+"."+a+"_"+r+"_"+s:"stat_"+t+"."+a+"_"+r+"_"+s,$(o).attr({"data-stat-pid":i,"data-stat-aid":n})})}function i(e){if("cart"!==n.page&&n.useCarousel){var t=e.find("ul").eq(0);t&&t.carousel({containerSelector:e,controls:n.carouselControl,pager:n.carouselPage,itemHeight:320})}n.isBuy&&($(".J_xm-recommend-list").hover(function(){$(this).find(".J_xm-recommend-btn").show()},function(){$(this).find(".J_xm-recommend-btn").hide()}),$(".J_xm-recommend-btn").off(".addcart").on("click.addcart",function(){function e(){a.removeClass("xm-recommend-notice-active"),setTimeout(function(){t.removeClass("disabled"),a.empty()},500)}var t=$(this),a=t.parent().siblings(".xm-recommend-notice");return t.hasClass("disabled")?!1:(MI.addShopCart(t.attr("data-stat-gid"),function(t){1===t.code?"cart"!==n.page?(a.addClass("xm-recommend-notice-active").empty().append('<a class="btn btn-block btn-green btn-notice" href="javascript: void(0);">成功加入购物车</a>'),a.find(".btn-notice").one("click",e),setTimeout(function(){e(),location.reload()},1e3)):location.href=MI.GLOBAL_CONFIG.staticSite+"/cart/":alert(t.msg)}),!1)})),o(e,n.page,n.pageName),$.isFunction($("body").linkSign)&&e.linkSign({live:!0});var a=e.attr("id"),i="re-"+n.page+"."+n.tips;$.force_appear(),e.appear(),e.one("appear",function(){if("undefined"!=typeof _msq&&_msq.push(["trackPanelShow",a,i]),!e.data("log_codes")){for(var t=e.find(".J_xm-recommend-list").find("dt").find("a"),o="",r=0,n=t.length;n>r;r++)o+=t.eq(r).data("log_code")+";";e.attr("data-log_codes",o.substring(0,o.length-1))}})}a(3),a(4);var r={},n={},c=function(e){try{return e.replace(/\s/g,"")}catch(t){return e}};!function(e){function t(e,t,o,r){if(e.length<5)return!1;var c=a(5),s={v:1,data:e,useCarousel:n.useCarousel,isBuy:n.isBuy,itemSite:MI.GLOBAL_CONFIG.itemSite,title:r?"买购物车中商品的人还看了":n.title,page:n.page,hideTitle:n.hideTitle,type:t.type};o.addClass("container").html(c(s)),i(o),null!==t.callback&&"function"==typeof t.callback&&t.callback()}function o(e){return e.length<5?!1:(e.length>20&&(e=e.slice(0,20)),e.length>15&&e.length<20&&(e=e.slice(0,15)),e.length>10&&e.length<15&&(e=e.slice(0,10)),e.length>5&&e.length<10&&(e=e.slice(0,5)),e)}function c(a){var i=n.api,c={cid:r.gid};e.ajax({url:i,dataType:"jsonp",jsonp:"jsonpcallback",cache:!0,data:c,success:function(i){if(0===i.code){i=i.data||{};var n=e(a);"buyRecommend"===r.type||"paySuccess"===r.type?(t(o(i.alsobuy),r,n),r.type="dirHistoryRecommend",n=e("#J_historyRecommend"),t(o(i.alsoview),r,n,!0)):t(o(i),r,n)}}})}var s={recommendBox:{api:"//rec.www.mi.com/rec/cartbuy",title:"买购物车中商品的人还买了",isBuy:!0,page:"Cart",pageName:"购物车",tips:"购物车推荐",useCarousel:!1},historyRecommend:{api:"//rec.www.mi.com/rec/cartempty",title:"为您推荐",isBuy:!0,page:"Cart",pageName:"购物车",tips:"猜你喜欢",useCarousel:!1},dirHistoryRecommend:{api:"//rec.www.mi.com/rec/cartsuccess",title:"根据浏览向您推荐",isBuy:!0,page:"CartSuc",pageName:"加购成功",tips:"看了还看",useCarousel:!1},alsoBuy:{api:"//rec.www.mi.com/rec/detail",title:"买过该商品的人还买了",isBuy:!0,page:"ItemTail",pageName:"单品页底部",tips:"买过该商品的人还买了",useCarousel:!0,carouselControl:!1,carouselPage:!0},buyRecommend:{api:"//rec.www.mi.com/rec/cartsuccess",title:"买购物车中商品的人还买了",isBuy:!0,page:"CartSuc",pageName:"加购成功",tips:"买过该商品的人还买了",useCarousel:!0,carouselControl:!1,carouselPage:!0},searchHistoryRecommend:{api:"//rec.www.mi.com/rec/search",title:"您还看了",isBuy:!0,page:"Search",pageName:"搜索页",tips:"您还看了",useCarousel:!0,carouselControl:!1,carouselPage:!0},homeRecommend:{api:"//rec.www.mi.com/rec/guesslike",title:"为你推荐",isBuy:!1,page:"Home",pageName:"首页",tips:"为你推荐",useCarousel:!0,carouselControl:!0,carouselPage:!1,hideTitle:!0},paySuccess:{api:"//rec.www.mi.com/rec/cartsuccess",title:"为你推荐",isBuy:!0,page:"CartSuc",pageName:"支付成功",tips:"为你推荐",useCarousel:!0,carouselControl:!1,carouselPage:!0}};e.fn.miRecommend=function(t){r=e.extend(s,t),n=r[r.type],c(this)}}(jQuery)},function(e,t){!function(e){function t(t){function a(){return 0>=x?!1:(C&&clearInterval(C),void(C=setTimeout(function(){var e=_===x-1?0:_+1;o(e),a()},g.pause)))}function o(e){return _===e?!1:(y.css({marginLeft:-h*f*e,transition:"margin-left "+g.speed/1e3+"s "+g.easing}),g.controls&&(0===e?d.addClass("control-disabled"):d.removeClass("control-disabled"),e===x-1?u.addClass("control-disabled"):u.removeClass("control-disabled")),g.pager&&m.find("li").eq(e).addClass("pager-active").siblings().removeClass("pager-active"),void(_=e))}function i(){for(var t='<ul class="xm-pagers">',a=0,i=x;i>a;a+=1)t+='<li class="pager'+(0===a?" pager-active":"")+'"><span class="dot">'+(a+1)+"</span></li>";t+="</ul>",m.html(t),m.find("li").off(".carousel").on("click.carousel",function(){e(this).addClass("pager-active").siblings().removeClass("pager-active"),o(m.find("li").index(e(this)))})}function r(){f=g.itemPerSlide||Math.ceil(c.width()/h),x=Math.ceil(s.length/f),1>=x||(o(0),g.pager&&i(),g.auto&&(a(),g.controls&&l.find(".control").off(".carousel").on({"mouseenter.carousel":function(){C&&clearTimeout(C)},"mouseleave.carousel":function(){a()}}),g.pager&&m.find(".pager").off(".carousel").on({"mouseenter.carousel":function(){C&&clearTimeout(C)},"mouseleave.carousel":function(){a()}})))}var n,c,s,l,d,u,m,p,g,f,h,v,x,y=e(this),C=0,_=-1;return p={itemSelector:"> li",itemWidth:null,itemHeight:null,itemPerSlide:null,containerSelector:null,controlsSelector:null,pagersSelector:null,speed:500,easing:"ease",auto:!1,pause:5e3,controls:!0,controlsClass:"xm-controls-line-small",pager:!1,onLoad:e.noop},g=e.extend({},p,t),s=y.find(g.itemSelector),g.itemPerSlide&&s.length<=g.itemPerSlide?this:(h=g.itemWidth||s.outerWidth(!0),v=g.itemHeight||s.outerHeight(),n=g.containerSelector?y.closest(g.containerSelector):y.parent(),n.addClass("xm-carousel-container"),c=y.wrap('<div class="xm-carousel-wrapper"></div>').closest(".xm-carousel-wrapper").css({height:v,overflow:"hidden"}),y.css("width",h*s.length),g.controls&&(l=e('<div class="xm-controls '+g.controlsClass+' xm-carousel-controls"><a class="control control-prev iconfont" href="javascript: void(0);">&#xe628;</a><a class="control control-next iconfont" href="javascript: void(0);">&#xe623;</a></div>'),g.controlsSelector?n.find(g.controlsSelector).append(l):l.insertAfter(c),d=l.find(".control-prev"),u=l.find(".control-next"),d.on("click",function(t){t.preventDefault(),e(this).hasClass("control-disabled")||o(_-1)}),u.on("click",function(t){t.preventDefault(),e(this).hasClass("control-disabled")||o(_+1)})),g.pager&&(m=e('<div class="xm-pagers-wrapper"></div>'),g.pagersSelector?n.find(g.pagersSelector).append(m):m.insertAfter(c)),r(),g.onLoad(y),void e(window).on("resize",r))}e.fn.carousel=function(e){return this.each(function(){t.call(this,e)}),this}}(jQuery)},function(e,t){!function(e){function t(){r=!1;for(var t=0,i=o.length;i>t;t++){var n=e(o[t]).filter(function(){return e(this).is(":appeared")});if(n.trigger("appear",[n]),a){var c=a.not(n);c.trigger("disappear",[c])}a=n}}var a,o=[],i=!1,r=!1,n={interval:250,force_process:!1},c=e(window);e.expr[":"].appeared=function(t){var a=e(t);if(!a.is(":visible"))return!1;var o=c.scrollLeft(),i=c.scrollTop(),r=a.offset(),n=r.left,s=r.top;return s+a.height()>=i&&s-(a.data("appear-top-offset")||0)<=i+c.height()&&n+a.width()>=o&&n-(a.data("appear-left-offset")||0)<=o+c.width()?!0:!1},e.fn.extend({appear:function(a){var c=e.extend({},n,a||{}),s=this.selector||this;if(!i){var l=function(){r||(r=!0,setTimeout(t,c.interval))};e(window).scroll(l).resize(l),i=!0}return c.force_process&&setTimeout(t,c.interval),o.push(s),e(s)}}),e.extend({force_appear:function(){return i?(t(),!0):!1}})}(jQuery)},function(e,t){e.exports=function(e){var t="";e.title&&!e.hideTitle&&(t+='<h2 class="xm-recommend-title"><span>'+e.title+"</span></h2>"),t+='<div class="xm-recommend"> ',t+=e.useCarousel?' <ul class="xm-carousel-col-5-list xm-carousel-list clearfix"> ':' <ul class="row clearfix"> ';var a=e.data;if(a)for(var o,i=-1,r=a.length-1;r>i;){o=a[i+=1],t+=" ",t+=e.useCarousel?' <li class="J_xm-recommend-list"> ':' <li class="J_xm-recommend-list span4"> ',t+=" ";var n=/.jpg|.jpeg|.png/,c=n.exec(o.image),s="!140x140"+c,l="!280x280"+c;if(t+=" ",o.ext&&o.ext.img&&o.ext.url){t+=" ";var n=/.jpg|.jpeg|.png/,d=n.exec(o.ext.img),u="!234x300"+d,m="!468x600"+d;t+=' <a target="_blank" href="'+o.ext.url+'" data-log_code="'+o.logcode+'" data-stat-method="'+e.v+"_"+o.algorithm+'" data-stat-index='+i+' data-stat-text="'+o.name+'"> <img src="'+o.ext.img.replace(/.jpg|.png|.jpeg/,u)+'" srcset="'+o.ext.img.replace(/.jpg|.png|.jpeg/,m)+'  2x" alt="'+o.name+'" /> </a> '}else t+=' <dl> <dt> <a href="'+e.itemSite+"/"+o.commodityid+'.html" data-log_code="'+o.logcode+'" data-stat-method="'+e.v+"_"+o.algorithm+'" data-stat-index='+i+' data-stat-text="'+o.name+'" target="_blank"> <img src="'+o.image.replace(/.jpg|.png|.jpeg/,s)+'" srcset="'+o.image.replace(/.jpg|.png|.jpeg/,l)+'  2x" alt="'+o.name+'" /> </a> </dt> <dd class="xm-recommend-name"> <a href="'+e.itemSite+"/"+o.commodityid+'.html" data-log_code="'+o.logcode+'" data-stat-method="'+e.v+"_"+o.algorithm+'" data-stat-index='+i+' target="_blank"> '+o.name+' </a> </dd> <dd class="xm-recommend-price">'+o.price+'元</dd> <dd class="xm-recommend-tips"> ',o.comments&&(t+=" ",parseInt(o.comments)>0&&(t+=" "+o.comments+"人好评 "),t+=" "),t+=" ",e.isBuy&&(t+=' <a href="'+e.itemSite+"/cart/add/"+o.goodsid+'-0-1" data-log_code="'+o.logcode+'" data-stat-gid="'+o.goodsid+'" data-stat-method="'+e.v+"_"+o.algorithm+'" data-stat-index='+i+' data-stat-text="'+o.name+'" data-stat-addcart="加购" class="btn btn-small btn-line-primary J_xm-recommend-btn">加入购物车</a> '),t+=' </dd> <dd class="xm-recommend-notice"></dd> </dl> ';t+=" </li>"}return t+="</ul></div>"}}]);